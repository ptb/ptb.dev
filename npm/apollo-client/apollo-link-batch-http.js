/*! @copyright Apollo GraphQL | @license MIT | @link apollographql.com | @version 1.2.11 *//* eslint-disable */import{__extends as t,__rest as e,__assign as n}from"./tslib.js";import{ApolloLink as r,fromError as a,Observable as o}from"./apollo-link.js";import{checkFetcher as i,selectURI as c,selectHttpOptionsAndBody as s,fallbackHttpConfig as l,serializeFetchParameter as h,createSignalIfSupported as u,parseAndCheckHttpResponse as p}from"./apollo-link-http-common.js";import{BatchLink as f}from"./apollo-link-batch.js";var b=function(r){function b(t){var b=r.call(this)||this,d=t||{},m=d.uri,v=void 0===m?"/graphql":m,x=d.fetch,g=d.includeExtensions,y=d.batchInterval,E=d.batchMax,q=d.batchKey,w=e(d,["uri","fetch","includeExtensions","batchInterval","batchMax","batchKey"]);i(x),x||(x=fetch);var I={http:{includeExtensions:g},options:w.fetchOptions,credentials:w.credentials,headers:w.headers};b.batchInterval=y||10,b.batchMax=E||10;return q=q||function(t){var e=t.getContext(),n={http:e.http,options:e.fetchOptions,credentials:e.credentials,headers:e.headers};return c(t,v)+JSON.stringify(n)},b.batcher=new f({batchInterval:b.batchInterval,batchMax:b.batchMax,batchKey:q,batchHandler:function(t){var e=c(t[0],v),r=t[0].getContext(),i={};if(r.clientAwareness){var f=r.clientAwareness,b=f.name,d=f.version;b&&(i["apollographql-client-name"]=b),d&&(i["apollographql-client-version"]=d)}var m,g={http:r.http,options:r.fetchOptions,credentials:r.credentials,headers:n({},i,r.headers)},y=t.map(function(t){return s(t,l,I,g)}),E=y.map(function(t){return t.body}),q=y[0].options;if("GET"===q.method)return a(new Error("apollo-link-batch-http does not support GET requests"));try{q.body=h(E,"Payload")}catch(t){return a(t)}if(!q.signal){var w=u(),M=w.controller,k=w.signal;(m=M)&&(q.signal=k)}return new o(function(n){return x(e,q).then(function(e){return t.forEach(function(t){return t.setContext({response:e})}),e}).then(p(t)).then(function(t){return n.next(t),n.complete(),t}).catch(function(t){"AbortError"!==t.name&&(t.result&&t.result.errors&&t.result.data&&n.next(t.result),n.error(t))}),function(){m&&m.abort()}})}}),b}return t(b,r),b.prototype.request=function(t){return this.batcher.request(t)},b}(r);export{b as BatchHttpLink};